var properties = {
    "data": [
        {
            "id": 1,
            "title": "Confortable and ample apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": true,
            "latitude": 51.541599,
            "longitude": -0.112588,
            "address": "912 Southern Ave, Blythe",
            //"type" : "For Sale",
            "Category" : "Appartment",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/1.jpg",
            "type_icon": "images/map/building.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 2,
            "title": "Contemporary apartment",
            "price": 2505.11,
            "listing_for": "Rent",
            //"is_featured": false,
            "latitude": 51.538395,
            "longitude": -0.097418,
            "address": "204 Cottonwood Ln, Blythe, CA 92225 ",
            //"type" : "For Rent",
            "Category" : "Villa",
            "area": 2103,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/2.jpg",
            "type_icon": "images/map/building2.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 5,
            "title": "Contemporary apartment",
            "price": 2505.11,
            "listing_for": "Rent",
            //"is_featured": false,
            "latitude": 51.513965,
            "longitude": -0.038837,
            "address": "1216 Drown Avenue, Ojai, CA 93023",
            //"type" : "For Rent",
            "Category" : "Family Home",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/5.jpg",
            "type_icon": "images/map/building3.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 6,
            "title": "Contemporary apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": false,
            "latitude": 51.503965,
            "longitude": -0.058837,
            "address": "1216 Pinetree Drive, Frazier Park",
            //"type" : "For Sale",
            "Category" : "Villa",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/6.jpg",
            "type_icon": "images/map/building4.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 7,
            "title": "Confortable and ample apartment",
            "price": 2505.11,
            "listing_for": "For Rent",
            //"is_featured": false,
            "latitude": 51.555385,
            "longitude": -0.128274,
            "address": "1216 Portesuello Ave, Santa Barbara",
            //"type" : "For Rent",
            "Category" : "Appartment",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/5.jpg",
            "type_icon": "images/map/building5.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 8,
            "title": "Ample apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": false,
            "latitude": 51.560935,
            "longitude": -0.111365,
            "address": "1216 Del Oro Ave, Santa Barbara",
            //"type" : "For Rent",
            "Category" : "Villa",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "balcony": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/4.jpg",
            "type_icon": "images/map/building2.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 9,
            "title": "ample apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": false,
            "latitude": 51.543803,
            "longitude": -0.036607,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Sale",
            "Category" : "Family Home",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/1.jpg",
            "type_icon": "images/map/building3.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 10,
            "title": "Confortable and ample apartment",
            "price": 2505,
            "listing_for": "For Rent",
            //"is_featured": false,
            "latitude": 51.539011,
            "longitude": -0.142555,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Sale",
            "Category" : "Villa",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/1.jpg",
            "type_icon": "images/map/building.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 11,
            "title": "Confortable apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": false,
            "latitude": 51.547623,
            "longitude": -0.071113,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Sale",
            "Category" : "Villa",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/1.jpg",
            "type_icon": "images/map/building4.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 12,
            "title": "Confortable and ample apartment",
            "price": 2505.11,
            "listing_for": "For Rent",
            //"is_featured": true,
            "latitude": 51.550644,
            "longitude": -0.103493,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Rent",
            "Category" : "Family Home",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/9.jpg",
            "type_icon": "images/map/building5.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 13,
            "title": "Contemporary apartment",
            "price": 2505.11,
            "listing_for": "For Rent",
            //"is_featured": false,
            "latitude": 51.532112,
            "longitude": -0.051885,
            "address": "20-21 Kathal St. Tampa City, FL",
           // "type" : "For Rent",
            "Category" : "Appartment",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/8.jpg",
            "type_icon": "images/map/building.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 14,
            "title": "Contemporary apartment",
            "price": 2505.11,
            "listing_for": "Sale",
            //"is_featured": true,
            "latitude": 51.531311,
            "longitude": -0.052314,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Rent",
            "Category" : "Appartment",
           "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/1.jpg",
            "type_icon": "images/map/building3.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        },
        {
            "id": 15,
            "title": "Hot Contemporary apartment",
            "price": 2505.11,
            "listing_for": "Rent",
            //"is_featured": false,
            "latitude": 51.530189,
            "longitude": -0.078750,
            "address": "20-21 Kathal St. Tampa City, FL",
            //"type" : "For Rent",
            "Category" : "Appartment",
            "area": 2123,
            "room": 4,
            "bathroom": 3,
            "bedroom": 3,
            "lounge": 1,
            "garage": 1,
            "image": "images/map/7.jpg",
            "type_icon": "images/map/building3.png",
            "description": "Curabitur odio nibh, luc pien vitae, euismod arcu. Curabitur odio nibh, luc pien vitae, euismod arcu."
        }

    ]
};

function drawInfoWindow(property) {
    var image = 'images/map/4.jpg';
    if (property.image) {
        image = property.image
    }

    var title = 'N/A';
    if (property.title) {
        title = property.title
    }

    var address = '';
    if (property.address) {
        address = property.address
    }

    var area = 1000;
    if (property.area) {
        area = property.area
    }

    var bedroom = 6;
    if (property.bedroom) {
        bedroom = property.bedroom
    }

    var bathroom = 5;
    if (property.bathroom) {
        bathroom = property.bathroom
    }

    var garage = 1;
    if (property.garage) {
        garage = property.garage
    }

    var price = 203.33;
    if (property.price) {
        price = property.price
    }

    var Category = 'property catagorie';
    if (property.Category) {
        Category = property.Category
    }
    
    var listing_for = 'property type';
    if (property.listing_for) {
        listing_for = property.listing_for
    }

    var ibContent = '';
    ibContent =
    '<div class="property-single-item">'+
        '<div class="property-image-holder overlay">'+
            '<img src="'+image+'" alt="realestate property image">'+
            '<span class="property-rent '+((listing_for == 'Rent')? 'rent' : 'sale')+'">'+listing_for+'</span>'+
            '<span class="property-catagorie">'+Category+'</span>'+
            '<div class="property-link">'+
               '<a href="property-details.html" class="color-bg"> <i class="perch-link"></i></a>'+
            '</div>'+
        '</div>'+
        '<div class="property-details">'+
            '<h4><a href="property-details.html">'+title+'</a> </h4>'+
            '<ul class="list-inline property-price">'+
              '<li class="color-text"> <strong><span>$</span>'+price+'/month</strong></li>'+
            '</ul>'+
            '<div class="property-basic">'+
                '<ul class="list-inline">'+
                    '<li><i class="icon-area"></i>'+area+' sq/Ft</li>'+
                    '<li class="pull-right"><i class="icon-bed"></i>'+bedroom+' </li>'+
                    '<li class="pull-right"><i class="icon-bathroom"></i>'+bathroom+' </li>'+
                '</ul>'+
            '</div>' + 
            '<div class="property-location">'+
                '<ul class="list-inline">'+
                    '<li><span class="color-text"><i class="perch-marker2 color-text"></i></span>'+ address +'</li>'+
                    '<li><a href="#" class="color-text wishlist"><i class="perch-heart-o color-text"></i></a></li>'+
                '</ul>'+
            '</div>'+
        '</div><!-- property-details -->'+ 
    '</div>';

    return ibContent;
}


function animatedMarkers(map, propertiesMarkers, properties, layout) {
    var bounds = map.getBounds();
    var propertiesArray = [];
    $.each(propertiesMarkers, function (key, value) {
        if (bounds.contains(propertiesMarkers[key].getLatLng())) {
           
            setTimeout(function () {
                if (propertiesMarkers[key]._icon != null) {
                    propertiesMarkers[key]._icon.className = 'leaflet-marker-icon leaflet-zoom-animated leaflet-clickable bounce-animation marker-loaded';
                }
            }, key * 50);
        }
        else {
            if (propertiesMarkers[key]._icon != null) {
                propertiesMarkers[key]._icon.className = 'leaflet-marker-icon leaflet-zoom-animated leaflet-clickable';
            }
        }
    });
    $('.fetching-properties').html(propertiesArray);
}

function generateMap(latitude, longitude, mapProvider, layout) {

    var map = L.map('map', {
        center: [latitude, longitude],
        zoom: 14,
        scrollWheelZoom: false
    });

    L.tileLayer.provider(mapProvider).addTo(map);
    var markers = L.markerClusterGroup({
        showCoverageOnHover: true,
        zoomToBoundsOnClick: true,        
        iconCreateFunction: function(cluster) {
            return L.divIcon({ 
                html: '<b>' + cluster.getChildCount() + '</b>' 
            });
        }
    });

    var propertiesMarkers = [];

    $.each(properties.data, function (index, property) {
        var icon = '<img src="img/logos/logo.png">';
        if (property.type_icon) {
            icon = '<img src="' + property.type_icon + '">';
        }
        var color = '';
        var markerContent =
            '<div class="map-marker ' + color + '">' +
            '<div class="icon">' +
            icon +
            '</div>' +
            '</div>';

        var _icon = L.divIcon({
            html: markerContent,
            iconSize: [36, 46],
            iconAnchor: [18, 32],
            popupAnchor: [130, -28],
            className: ''
        });

        var marker = L.marker(new L.LatLng(property.latitude, property.longitude), {
            title: property.title,
            icon: _icon
        });

        propertiesMarkers.push(marker);
        marker.bindPopup(drawInfoWindow(property));
        markers.addLayer(marker);
        marker.on('popupopen', function () {
            this._icon.className += ' marker-active';
        });
        marker.on('popupclose', function () {
            this._icon.className = 'leaflet-marker-icon leaflet-zoom-animated leaflet-clickable marker-loaded';
        });
    });

    map.addLayer(markers);
    animatedMarkers(map, propertiesMarkers, properties, layout);
    map.on('moveend', function () {
        animatedMarkers(map, propertiesMarkers, properties, layout);
    });

    $('.fetching-properties .item').hover(
        function () {
            propertiesMarkers[$(this).attr('id') - 1]._icon.className = 'leaflet-marker-icon leaflet-zoom-animated leaflet-clickable marker-loaded marker-active';
        },
        function () {
            propertiesMarkers[$(this).attr('id') - 1]._icon.className = 'leaflet-marker-icon leaflet-zoom-animated leaflet-clickable marker-loaded';
        }
    );

    $('.geolocation').on("click", function () {
        map.locate({setView: true})
    });
    $('#map').removeClass('fade-map');
}